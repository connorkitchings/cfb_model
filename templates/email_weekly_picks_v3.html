<!DOCTYPE html>
<html
  lang="en"
  xmlns:v="urn:schemas-microsoft-com:vml"
  xmlns:o="urn:schemas-microsoft-com:office:office"
>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="x-apple-disable-message-reformatting" />
    <title>CK's CFB Picks — {{ year }} Week {{ week }}</title>
    <style>
      /* RESET & BASE */
      body {
        margin: 0;
        padding: 0;
        width: 100% !important;
        background-color: #f3f4f6;
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
      }
      img {
        border: 0;
        outline: none;
        text-decoration: none;
        -ms-interpolation-mode: bicubic;
      }
      table {
        border-collapse: collapse;
        mso-table-lspace: 0pt;
        mso-table-rspace: 0pt;
      }

      /* CONTAINER */
      .wrapper {
        width: 100%;
        table-layout: fixed;
        background-color: #f3f4f6;
        padding-bottom: 40px;
      }
      .main-card {
        background-color: #ffffff;
        margin: 0 auto;
        max-width: 720px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }

      /* HEADER */
      .header {
        background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        padding: 32px 20px;
        text-align: center;
        color: #ffffff;
      }
      .header h1 {
        margin: 0 0 8px 0;
        font-size: 28px;
        font-weight: 700;
        letter-spacing: -0.5px;
      }
      .header p {
        margin: 0;
        font-size: 14px;
        opacity: 0.9;
      }

      /* SYSTEM INFO BOX */
      .sys-box {
        background-color: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        margin: 20px;
        padding: 0;
        overflow: hidden;
      }
      .sys-header {
        background-color: #f1f5f9;
        padding: 10px;
        text-align: center;
        font-size: 14px;
        font-weight: 700;
        color: #334155;
        border-bottom: 1px solid #e2e8f0;
      }
      .sys-thresholds {
        background-color: #ffffff;
        padding: 10px;
        text-align: center;
        font-size: 12px;
        color: #475569;
        border-bottom: 1px solid #e2e8f0;
      }
      .sys-table {
        width: 100%;
      }
      .sys-table th {
        font-size: 11px;
        text-transform: uppercase;
        color: #64748b;
        padding: 8px;
        background-color: #ffffff;
        border-bottom: 1px solid #cbd5e1;
        border-right: 1px solid #cbd5e1;
      }
      .sys-table td {
        font-size: 13px;
        color: #0f172a;
        padding: 8px;
        text-align: center;
        border-right: 1px solid #cbd5e1;
      }
      .sys-table td:last-child {
        border-right: none;
      }

      /* SECTION HEADERS */
      .section-header {
        text-align: center;
        padding: 25px 20px 15px;
        border-bottom: 2px solid #f1f5f9;
      }
      .section-title {
        font-size: 20px;
        font-weight: 800;
        color: #1e293b;
        margin: 0;
        display: inline-block;
      }
      .count-badge {
        background-color: #e2e8f0;
        color: #475569;
        font-size: 12px;
        font-weight: 600;
        padding: 2px 8px;
        border-radius: 10px;
        margin-left: 6px;
        vertical-align: middle;
      }

      /* BEST BET CARD (High Contrast) */
      .bb-wrapper {
        padding: 20px 20px 0 20px;
      }
      .bb-card {
        border: 2px solid #d97706;
        border-radius: 8px;
        background-color: #ffffff;
        overflow: hidden;
      }
      .bb-header {
        background-color: #d97706;
        color: #ffffff;
        text-align: center;
        padding: 8px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 14px;
      }
      .bb-body {
        padding: 20px;
        text-align: center;
      }
      .bb-matchup {
        font-size: 18px;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 12px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
      }
      .bb-grid {
        width: 100%;
        margin-top: 15px;
        border-top: 1px solid #f1f5f9;
        padding-top: 15px;
      }
      .bb-label {
        font-size: 11px;
        color: #64748b;
        text-transform: uppercase;
        font-weight: 600;
      }
      .bb-val {
        font-size: 16px;
        color: #0f172a;
        font-weight: 700;
      }
      .bb-edge {
        font-size: 18px;
        color: #0f172a;
        font-weight: 800;
      }
      .bb-pick {
        margin-top: 15px;
        background-color: #fffbeb;
        border: 1px dashed #d97706;
        padding: 10px;
        border-radius: 6px;
        color: #92400e;
        font-weight: 700;
        font-size: 16px;
      }

      /* DATA TABLES */
      .table-responsive {
        width: 100%;
        margin: 0;
      }
      .data-table {
        width: 100%;
      }
      .data-table th {
        background-color: #f8fafc;
        color: #64748b;
        font-size: 11px;
        text-transform: uppercase;
        font-weight: 700;
        padding: 12px 6px;
        border-bottom: 1px solid #e2e8f0;
      }
      .data-table td {
        padding: 12px 6px;
        border-bottom: 1px solid #f1f5f9;
        font-size: 13px;
        color: #334155;
        text-align: center;
        vertical-align: middle;
      }

      /* TABLE ELEMENTS */
      .dt-time {
        font-size: 11px;
        color: #94a3b8;
        line-height: 1.3;
      }
      .dt-matchup {
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        white-space: nowrap;
      }
      .logo-img {
        display: inline-block;
        vertical-align: middle;
        width: 20px;
        height: 20px;
      }
      .logo-lg {
        width: 28px;
        height: 28px;
      }

      /* BET BADGES */
      .bet-cell {
        font-weight: 700;
      }
      .bet-home {
        color: #15803d;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }
      .bet-away {
        color: #0369a1;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }
      .bet-neutral {
        color: #334155;
      }
      .edge-val {
        font-weight: 700;
        color: #15803d;
      }

      /* LEGEND */
      .legend {
        background-color: #fefce8;
        border: 1px solid #fde047;
        border-radius: 6px;
        padding: 12px 20px;
        margin: 0 20px 15px 20px;
        text-align: center;
      }
      .legend-title {
        font-size: 12px;
        font-weight: 700;
        color: #713f12;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .legend-items {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
      }
      .legend-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        color: #422006;
      }
      .legend-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
      }
      .dot-home {
        background-color: #15803d;
      }
      .dot-away {
        background-color: #0369a1;
      }
      .dot-ml {
        background-color: #ca8a04;
      }

      /* FOOTER */
      .footer {
        padding: 30px 20px;
        background-color: #f8fafc;
        text-align: center;
        border-top: 1px solid #e2e8f0;
      }
      .footer-text {
        font-size: 12px;
        color: #64748b;
        line-height: 1.5;
        margin-bottom: 10px;
      }
      .footer a {
        color: #3b82f6;
        text-decoration: none;
      }

      /* DARK MODE */
      @media (prefers-color-scheme: dark) {
        body,
        .wrapper {
          background-color: #000000 !important;
        }
        .main-card {
          background-color: #111111 !important;
          box-shadow: none;
          border: 1px solid #333;
        }
        .section-header {
          border-bottom-color: #333 !important;
        }
        .section-title {
          color: #f3f4f6 !important;
        }
        .count-badge {
          background-color: #333 !important;
          color: #ccc !important;
        }
        .sys-box {
          background-color: #1a1a1a !important;
          border-color: #333 !important;
        }
        .sys-header {
          background-color: #222 !important;
          color: #e5e5e5 !important;
          border-bottom-color: #333 !important;
        }
        .sys-table th {
          background-color: #222 !important;
          color: #a3a3a3 !important;
          border-bottom-color: #333 !important;
        }
        .sys-table td {
          color: #e5e5e5 !important;
          border-right-color: #333 !important;
        }

        .bb-card {
          background-color: #1a1a1a !important;
          border-color: #b45309 !important;
        }
        .bb-header {
          background-color: #b45309 !important;
        }
        .bb-matchup {
          color: #ffffff !important;
        }
        .bb-val,
        .bb-edge {
          color: #ffffff !important;
        }
        .bb-grid {
          border-top-color: #333 !important;
        }
        .bb-pick {
          background-color: #2a1c05 !important;
          color: #fbbf24 !important;
          border-color: #b45309 !important;
        }

        .data-table th {
          background-color: #1a1a1a !important;
          color: #a3a3a3 !important;
          border-bottom-color: #333 !important;
        }
        .data-table td {
          color: #e5e5e5 !important;
          border-bottom-color: #262626 !important;
        }
        .footer {
          background-color: #111111 !important;
          border-top-color: #333 !important;
        }

        .bet-home {
          color: #86efac !important;
        }
        .bet-away {
          color: #7dd3fc !important;
        }
        .bet-neutral {
          color: #e5e5e5 !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <table
        role="presentation"
        cellpadding="0"
        cellspacing="0"
        border="0"
        align="center"
        width="100%"
      >
        <tr>
          <td align="center" style="padding-top: 20px">
            <table
              role="presentation"
              class="main-card"
              cellpadding="0"
              cellspacing="0"
              border="0"
              width="100%"
            >
              <tr>
                <td class="header">
                  <h1>CK's CFB Picks</h1>
                  <p>{{ year }} Week {{ week }} • {{ date_range }}</p>
                  <p style="font-size: 11px; margin-top: 6px; opacity: 0.7">
                    Generated {{ generated_at }}
                  </p>
                </td>
              </tr>

              <tr>
                <td>
                  <div class="sys-box">
                    <div class="sys-header">System Info</div>
                    <div class="sys-thresholds">
                      {{ model_context.model_name }}
                      <span style="font-weight: 400; opacity: 0.7"
                        >(ID: {{ model_context.model_id }})</span
                      >
                      <br />
                      <strong style="margin-top: 6px; display: inline-block"
                        >Betting Thresholds:</strong
                      >
                      Spread Edge ≥ {{ spread_threshold }} pts • Total Edge ≥ {{
                      total_threshold }} pts
                    </div>
                    <table class="sys-table" cellpadding="0" cellspacing="0">
                      <tr>
                        <th style="width: 30%">Period</th>
                        <th style="width: 35%">Spread Record</th>
                        <th style="width: 35%">Total Record</th>
                      </tr>
                      <tr>
                        <td
                          style="
                            font-weight: 600;
                            text-align: left;
                            padding-left: 12px;
                          "
                        >
                          Last Year ({{ model_context.prev_year }})
                        </td>
                        <td>
                          {% if model_context.prev_spread_wins is not none %} {{
                          model_context.prev_spread_wins }}-{{
                          model_context.prev_spread_count -
                          model_context.prev_spread_wins }}
                          <br /><span style="font-size: 10px; color: #64748b"
                            >{{ (model_context.prev_spread * 100) | round(1)
                            }}%</span
                          >
                          {% else %} - {% endif %}
                        </td>
                        <td>
                          {% if model_context.prev_total_wins is not none %} {{
                          model_context.prev_total_wins }}-{{
                          model_context.prev_total_count -
                          model_context.prev_total_wins }}
                          <br /><span style="font-size: 10px; color: #64748b"
                            >{{ (model_context.prev_total * 100) | round(1)
                            }}%</span
                          >
                          {% else %} - {% endif %}
                        </td>
                      </tr>
                      <tr>
                        <td
                          style="
                            font-weight: 600;
                            text-align: left;
                            padding-left: 12px;
                          "
                        >
                          Current ({{ model_context.curr_year }})
                        </td>
                        <td style="background-color: #ffffff">
                          {% if model_context.curr_spread_wins is not none %}
                          <span style="color: #1e40af; font-weight: 700"
                            >{{ model_context.curr_spread_wins }}-{{
                            model_context.curr_spread_count -
                            model_context.curr_spread_wins }}</span
                          >
                          <br /><span style="font-size: 10px; color: #3b82f6"
                            >{{ (model_context.curr_spread * 100) | round(1)
                            }}%</span
                          >
                          {% else %} - {% endif %}
                        </td>
                        <td style="background-color: #ffffff">
                          {% if model_context.curr_total_wins is not none %}
                          <span style="color: #1e40af; font-weight: 700"
                            >{{ model_context.curr_total_wins }}-{{
                            model_context.curr_total_count -
                            model_context.curr_total_wins }}</span
                          >
                          <br /><span style="font-size: 10px; color: #3b82f6"
                            >{{ (model_context.curr_total * 100) | round(1)
                            }}%</span
                          >
                          {% else %} - {% endif %}
                        </td>
                      </tr>
                      <tr>
                        <td
                          style="
                            font-weight: 600;
                            text-align: left;
                            padding-left: 12px;
                          "
                        >
                          Hist. Wk {{ week }}
                        </td>
                        <td>
                          {% if model_context.last_year_week_spread_wins is not
                          none %} {{ (model_context.last_year_week_spread * 100)
                          | round(1) }}% {% else %} - {% endif %}
                        </td>
                        <td>
                          {% if model_context.last_year_week_total_wins is not
                          none %} {{ (model_context.last_year_week_total * 100)
                          | round(1) }}% {% else %} - {% endif %}
                        </td>
                      </tr>
                    </table>
                  </div>
                </td>
              </tr>

              {% if best_bet %}
              <tr>
                <td class="bb-wrapper">
                  <div class="bb-card">
                    <div class="bb-header">⭐ Best Bet of the Week</div>
                    <div class="bb-body">
                      <div class="bb-matchup">
                        <img
                          src="cid:{{ best_bet.away_team_logo_cid }}"
                          class="logo-lg"
                        />
                        <span
                          >{{ best_bet.away_team }} @ {{ best_bet.home_team
                          }}</span
                        >
                        <img
                          src="cid:{{ best_bet.home_team_logo_cid }}"
                          class="logo-lg"
                        />
                      </div>

                      <div class="bb-pick">PICK: {{ best_bet.bet }}</div>

                      <table class="bb-grid" cellpadding="0" cellspacing="0">
                        <tr>
                          <td width="33%">
                            <div class="bb-label">Line</div>
                            <div class="bb-val">
                              {{ best_bet.line_display }}
                            </div>
                          </td>
                          <td
                            width="33%"
                            style="
                              border-left: 1px solid #e2e8f0;
                              border-right: 1px solid #e2e8f0;
                            "
                          >
                            <div class="bb-label">Model</div>
                            <div class="bb-val">
                              {% if best_bet.category == 'Spread' %} {{
                              best_bet.home_team }} {{ "%+.1f" |
                              format(-best_bet.prediction) if
                              best_bet.prediction is not none else '' }} {% else
                              %} {{ "%.1f" | format(best_bet.prediction) if
                              best_bet.prediction is not none else '' }} {%
                              endif %}
                            </div>
                          </td>
                          <td width="33%">
                            <div class="bb-label">Edge</div>
                            <div class="bb-edge">
                              {{ best_bet.edge | round(1) if best_bet.edge is
                              not none else '' }}
                            </div>
                          </td>
                        </tr>
                      </table>
                    </div>
                  </div>
                </td>
              </tr>
              {% endif %} {% if spreads|length > 0 %}
              <tr>
                <td></td>
              </tr>
              <tr>
                <td>
                  <div class="section-header">
                    <h3 class="section-title">Spread Bets</h3>
                    <span class="count-badge">{{ spreads|length }}</span>
                  </div>
                  <table class="data-table" cellpadding="0" cellspacing="0">
                    <thead>
                      <tr>
                        <th width="15%">Time</th>
                        <th width="30%">Matchup</th>
                        <th width="15%">Line</th>
                        <th width="15%">Model</th>
                        <th width="10%">Edge</th>
                        <th width="10%">Bet</th>
                        <th width="5%">ML?</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for r in spreads %}
                      <tr>
                        <td class="dt-time">
                          {{ r.date_display }}<br />{{ r.time_display }}
                        </td>
                        <td>
                          <div class="dt-matchup">
                            <img
                              src="cid:{{ r.away_team_logo_cid }}"
                              class="logo-img"
                            />
                            <span>{{ r.away_team }} @ {{ r.home_team }}</span>
                            <img
                              src="cid:{{ r.home_team_logo_cid }}"
                              class="logo-img"
                            />
                          </div>
                        </td>
                        <td>
                          <div
                            style="
                              display: inline-flex;
                              align-items: center;
                              gap: 4px;
                            "
                          >
                            <img
                              src="cid:{{ r.line_logo_cid }}"
                              width="14"
                              height="14"
                            />
                            <span>{{ r.line_num_display }}</span>
                          </div>
                        </td>
                        <td>
                          <div
                            style="
                              display: inline-flex;
                              align-items: center;
                              gap: 4px;
                            "
                          >
                            <img
                              src="cid:{{ r.home_team_logo_cid }}"
                              width="14"
                              height="14"
                            />
                            <span
                              >{{ "%+.1f" | format(-r.predicted_spread) if
                              r.predicted_spread is not none else '' }}</span
                            >
                          </div>
                        </td>
                        <td class="edge-val">
                          {{ r.edge_spread | round(1) if r.edge_spread is not
                          none else '' }}
                        </td>
                        <td>
                          {% if r.bet_spread_team == r.home_team %}
                          <div class="bet-home">
                            <img
                              src="cid:{{ r.home_team_logo_cid }}"
                              width="14"
                              height="14"
                            />
                          </div>
                          {% elif r.bet_spread_team == r.away_team %}
                          <div class="bet-away">
                            <img
                              src="cid:{{ r.away_team_logo_cid }}"
                              width="14"
                              height="14"
                            />
                          </div>
                          {% else %}
                          <span class="bet-neutral"
                            >{{ r.bet_spread_team }}</span
                          >
                          {% endif %}
                        </td>
                        <td style="font-weight: 700; color: #b45309">
                          {{ r.consider_moneyline }}
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </td>
              </tr>
              {% endif %} {% if totals|length > 0 %}
              <tr>
                <td>
                  <div class="section-header">
                    <h3 class="section-title">Total Bets</h3>
                    <span class="count-badge">{{ totals|length }}</span>
                  </div>
                  <table class="data-table" cellpadding="0" cellspacing="0">
                    <thead>
                      <tr>
                        <th width="15%">Time</th>
                        <th width="35%">Matchup</th>
                        <th width="15%">O/U</th>
                        <th width="15%">Model</th>
                        <th width="10%">Edge</th>
                        <th width="10%">Bet</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for r in totals %}
                      <tr>
                        <td class="dt-time">
                          {{ r.date_display }}<br />{{ r.time_display }}
                        </td>
                        <td>
                          <div class="dt-matchup">
                            <img
                              src="cid:{{ r.away_team_logo_cid }}"
                              class="logo-img"
                            />
                            <span>{{ r.away_team }} @ {{ r.home_team }}</span>
                            <img
                              src="cid:{{ r.home_team_logo_cid }}"
                              class="logo-img"
                            />
                          </div>
                        </td>
                        <td>
                          {{ r.total_line | round(1) if r.total_line is not none
                          else '' }}
                        </td>
                        <td>
                          {{ "%.1f" | format(r.predicted_total) if
                          r.predicted_total is not none else '' }}
                        </td>
                        <td class="edge-val">
                          {{ r.edge_total | round(1) if r.edge_total is not none
                          else '' }}
                        </td>
                        <td>
                          <span class="bet-neutral">{{ r.bet_total }}</span>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </td>
              </tr>
              {% endif %}

              <tr>
                <td>
                  <div class="section-header">
                    <h3 class="section-title">Full Week {{ week }} Schedule</h3>
                    <span class="count-badge">{{ all_games|length }}</span>
                  </div>
                  <table class="data-table" cellpadding="0" cellspacing="0">
                    <thead>
                      <tr>
                        <th width="15%">Time</th>
                        <th width="35%">Matchup</th>
                        <th width="12%">Line</th>
                        <th width="12%">Model</th>
                        <th width="12%">Total</th>
                        <th width="12%">Model</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for r in all_games %}
                      <tr>
                        <td class="dt-time">
                          {{ r.date_display }}<br />{{ r.time_display }}
                        </td>
                        <td>
                          <div class="dt-matchup">
                            <img
                              src="cid:{{ r.away_team_logo_cid }}"
                              class="logo-img"
                            />
                            <span>{{ r.away_team }} @ {{ r.home_team }}</span>
                            <img
                              src="cid:{{ r.home_team_logo_cid }}"
                              class="logo-img"
                            />
                          </div>
                        </td>
                        <td>
                          <div
                            style="
                              display: inline-flex;
                              align-items: center;
                              gap: 2px;
                              font-size: 12px;
                            "
                          >
                            <img
                              src="cid:{{ r.line_logo_cid }}"
                              width="12"
                              height="12"
                            />
                            <span>{{ r.line_num_display }}</span>
                          </div>
                        </td>
                        <td>
                          <div
                            style="
                              display: inline-flex;
                              align-items: center;
                              gap: 2px;
                              font-size: 12px;
                            "
                          >
                            <img
                              src="cid:{{ r.home_team_logo_cid }}"
                              width="12"
                              height="12"
                            />
                            <span
                              >{{ "%+.1f" | format(-r.predicted_spread) if
                              r.predicted_spread is not none else '' }}</span
                            >
                          </div>
                        </td>
                        <td style="font-size: 12px">
                          {{ r.total_line | round(1) if r.total_line is not none
                          else '' }}
                        </td>
                        <td style="font-size: 12px">
                          {{ "%.1f" | format(r.predicted_total) if
                          r.predicted_total is not none else '' }}
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </td>
              </tr>

              <tr>
                <td class="footer">
                  <div class="footer-text">
                    Lines reflect consensus provider. Games excluded if teams
                    have < 2 FBS games played.
                  </div>
                  <div style="font-size: 11px; margin-top: 10px">
                    © {{ year }} cfb_model •
                    <a href="{{ docs_url }}">Documentation</a>
                  </div>
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </div>
  </body>
</html>

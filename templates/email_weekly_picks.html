<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CK's CFB Picks — {{ year }} Week {{ week }}</title>
    <style>
      /* Improved readability: subtle borders, zebra rows, clear headers */
      .hdr {
        background: #f6f8fa;
      }
      .th {
        font-size: 12px;
        color: #222;
        padding: 8px;
        border-bottom: 1px solid #ddd;
        text-align: center;
      }
      .td {
        font-size: 13px;
        color: #111;
        padding: 8px;
        border-bottom: 1px solid #eee;
        text-align: center;
        vertical-align: middle;
      }
      .zebra {
        background: #fafafa;
      }
      .logo {
        width: 24px;
        height: 24px;
        vertical-align: middle;
        display: inline-block;
        object-fit: contain;
      }
      @media (prefers-color-scheme: dark) {
        body {
          background: #111 !important;
          color: #eee !important;
        }
        .card,
        .table {
          background: #1a1a1a !important;
        }
        .muted {
          color: #bbb !important;
        }
        .border {
          border-color: #333 !important;
        }
        .hdr {
          background: #16181a !important;
        }
        .th {
          color: #e6e6e6 !important;
          border-bottom-color: #333 !important;
        }
        .td {
          color: #f0f0f0 !important;
          border-bottom-color: #2a2a2a !important;
        }
        .zebra {
          background: #151515 !important;
        }
      }
    </style>
  </head>
  <body
    style="
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial,
        sans-serif;
      background: #ffffff;
      color: #111111;
    "
  >
    <table
      role="presentation"
      cellpadding="0"
      cellspacing="0"
      width="100%"
      style="border-collapse: collapse"
    >
      <tr>
        <td align="center" style="padding: 24px 12px">
          <table
            role="presentation"
            cellpadding="0"
            cellspacing="0"
            width="720"
            class="card"
            style="
              border: 1px solid #e6e6e6;
              border-radius: 8px;
              background: #ffffff;
            "
          >
            <tr>
              <td style="padding: 20px 24px; border-bottom: 1px solid #eaeaea">
                <div
                  style="font-size: 20px; font-weight: 700; text-align: center"
                >
                  CK's CFB Picks — {{ year }} Week {{ week }} ({{ date_range }})
                </div>
                <div
                  class="muted"
                  style="
                    font-size: 12px;
                    color: #666;
                    margin-top: 4px;
                    text-align: center;
                  "
                >
                  Generated {{ generated_at }} • Spread ≥ {{ spread_threshold }} • Total ≥ {{ total_threshold }}
                </div>
                <!-- Model Context moved to top -->
                <div
                  style="
                    font-size: 14px;
                    font-weight: 700;
                    text-align: left;
                    margin-top: 16px;
                    color: #fff !important;
                  "
                >
                  {{ model_context.model_name }}
                  <span style="font-weight: 400; color: #fff !important; font-size: 12px; margin-left: 4px;">(ID: {{ model_context.model_id }})</span>
                </div>
                <div
                  class="muted"
                  style="font-size: 12px; margin-top: 4px; text-align: left"
                >
                  Last Season ({{ model_context.prev_year }}): Spread {% if
                  model_context.prev_spread_wins is not none %}{{ model_context.prev_spread_wins }}/{{ model_context.prev_spread_count }} ({{ (model_context.prev_spread * 100) | round(1) }}%){% else %}n/a{% endif %}, Total {% if
                  model_context.prev_total_wins is not none %}{{ model_context.prev_total_wins }}/{{ model_context.prev_total_count }} ({{ (model_context.prev_total * 100) | round(1) }}%){% else %}n/a{% endif %}
                  <br />
                  Current Season ({{ model_context.curr_year }}) through Week {{
                  model_context.curr_through_week }}: Spread {% if
                  model_context.curr_spread_wins is not none %}{{ model_context.curr_spread_wins }}/{{ model_context.curr_spread_count }} ({{ (model_context.curr_spread * 100) | round(1) }}%){% else %}n/a{% endif %}, Total {% if
                  model_context.curr_total_wins is not none %}{{ model_context.curr_total_wins }}/{{ model_context.curr_total_count }} ({{ (model_context.curr_total * 100) | round(1) }}%){% else %}n/a{% endif %}
                  <br />
                  This week last year (Week {{ week }}, {{
                  model_context.prev_year }}): Spread {% if
                  model_context.last_year_week_spread_wins is not none %}{{ model_context.last_year_week_spread_wins }}/{{ model_context.last_year_week_spread_count }} ({{ (model_context.last_year_week_spread * 100) | round(1) }}%){% else %}n/a{% endif %}, Total {% if
                  model_context.last_year_week_total_wins is not none %}{{ model_context.last_year_week_total_wins }}/{{ model_context.last_year_week_total_count }} ({{ (model_context.last_year_week_total * 100) | round(1) }}%){% else %}n/a{% endif %}
                </div>
                <div
                  style="margin: 10px 0; border-top: 1px solid #eaeaea"
                ></div>
                <!-- Quick Reference Guide -->
                <div style="margin-top: 10px; font-size: 13px">
                  <div
                    style="
                      font-weight: 600;
                      margin-bottom: 4px;
                      text-align: center;
                    "
                  >
                    Quick Reference
                  </div>
                  <div style="line-height: 1.6; text-align: center">
                    <strong>Edge:</strong> Diff between model & Vegas. Higher =
                    stronger.<br />
                    <strong>Line:</strong> Point spread. Negative = favored.<br />
                    <strong>O/U:</strong> Over/Under total points.
                  </div>
                </div>
              </td>
            </tr>

            {% if best_bet %}
            <!-- Best Bet -->
            <tr>
              <td style="padding: 16px 24px">
                <table
                  role="presentation"
                  width="100%"
                  cellpadding="0"
                  cellspacing="0"
                  style="border-collapse: collapse"
                >
                  <tr>
                    <td
                      style="
                        padding: 14px;
                        background: #e6f7ff;
                        border: 1px solid #1890ff;
                        border-radius: 6px;
                        color: #111;
                      "
                    >
                      <div
                        style="
                          font-weight: 700;
                          font-size: 14px;
                          margin-bottom: 6px;
                          text-align: center;
                          color: #0050b3;
                        "
                      >
                        ★ Best Bet ★
                      </div>
                      <div style="margin-top: 6px; text-align: center">
                        <img
                          class="logo"
                          src="cid:{{ best_bet.away_team_logo_cid }}"
                          alt="{{ best_bet.away_team }}"
                          width="32"
                          height="32"
                          style="
                            width: 32px;
                            height: 32px;
                            object-fit: contain;
                            vertical-align: middle;
                          "
                        />
                        <span
                          style="
                            margin: 0 8px;
                            font-weight: 600;
                            font-size: 14px;
                          "
                          >@</span
                        >
                        <img
                          class="logo"
                          src="cid:{{ best_bet.home_team_logo_cid }}"
                          alt="{{ best_bet.home_team }}"
                          width="32"
                          height="32"
                          style="
                            width: 32px;
                            height: 32px;
                            object-fit: contain;
                            vertical-align: middle;
                          "
                        />
                      </div>
                      <div
                        style="
                          font-size: 14px;
                          font-weight: 600;
                          color: #111;
                          text-align: center;
                          margin-top: 4px;
                        "
                      >
                        {{ best_bet.away_team }} @ {{ best_bet.home_team }}
                      </div>
                      <div
                        style="
                          font-size: 12px;
                          margin-top: 2px;
                          color: #666;
                          text-align: center;
                        "
                      >
                        {{ best_bet.datetime_display }} • {{ best_bet.category
                        }}
                      </div>
                      <div
                        style="
                          font-size: 14px;
                          margin-top: 8px;
                          color: #111;
                          text-align: center;
                          font-weight: 500;
                        "
                      >
                        Line: <strong>{{ best_bet.line_display }}</strong> •
                        Model:
                        <strong
                          >{% if best_bet.category == 'Spread' %}{{
                          best_bet.home_team }} {{ "%+.1f" |
                          format(-best_bet.prediction) if best_bet.prediction is
                          not none else '' }}{% else %}{{ "%.1f" |
                          format(best_bet.prediction) if best_bet.prediction is
                          not none else '' }}{% endif %}</strong
                        >
                      </div>
                      <div
                        style="
                          font-size: 14px;
                          margin-top: 4px;
                          color: #0050b3;
                          text-align: center;
                          font-weight: 700;
                        "
                      >
                        Bet: {{ best_bet.bet }} (Edge: {{ best_bet.edge |
                        round(1) if best_bet.edge is not none else '' }})
                      </div>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
            {% endif %}

          {% if spreads|length > 0 %}
          <!-- Spread Bets -->
          <tr>
            <td style="padding:8px 24px 4px;">
              <div style="font-weight:700; font-size:16px; margin-bottom:8px; text-align:center; border-bottom: 2px solid #eee; padding-bottom: 4px;">Spread Bets ({{ spreads|length }})</div>
                    <table
                      class="table"
                      cellpadding="0"
                      cellspacing="0"
                      width="100%"
                      style="
                        border-collapse: collapse;
                        width: 100%;
                        background: #fff;
                      "
                    >
                      <thead class="hdr">
                        <tr>
                          <th class="th">Date</th>
                          <th class="th">Matchup</th>
                          <th class="th">Line</th>
                          <th class="th">Model</th>
                          <th class="th">Edge</th>
                          <th class="th">Bet</th>
                          <th class="th">Moneyline</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for r in spreads %}
                        <tr
                          class="{% if loop.index0 % 2 == 1 %}zebra{% endif %}"
                        >
                          <td
                            class="td"
                            style="
                              font-size: 11px;
                              color: #666;
                              white-space: nowrap;
                            "
                          >
                            <div>{{ r.date_display }}</div>
                            <div>{{ r.time_display }}</div>
                          </td>
                          <td class="td" style="text-align: center">
                            <div style="white-space: nowrap">
                              <img
                                class="logo"
                                src="cid:{{ r.away_team_logo_cid }}"
                                style="width: 16px; height: 16px"
                              />
                              {{ r.away_team }}
                              <span style="font-size: 10px; color: #888; margin: 0 4px;">@</span>
                              <img
                                class="logo"
                                src="cid:{{ r.home_team_logo_cid }}"
                                style="width: 16px; height: 16px"
                              />
                              {{ r.home_team }}
                            </div>
                          </td>
                          <td class="td">
                            <div style="white-space: nowrap">
                              <img
                                class="logo"
                                src="cid:{{ r.line_logo_cid }}"
                                style="width: 16px; height: 16px"
                              />
                              <span style="font-weight: 600"
                                >{{ r.line_num_display }}</span
                              >
                            </div>
                          </td>
                          <td class="td">
                            <img
                              class="logo"
                              src="cid:{{ r.home_team_logo_cid }}"
                              style="width: 16px; height: 16px"
                            />
                            {{ "%+.1f" | format(-r.predicted_spread) if
                            r.predicted_spread is not none else '' }}
                          </td>
                          <td
                            class="td"
                            style="font-weight: 600; color: #2e7d32"
                          >
                            {{ r.edge_spread | round(1) if r.edge_spread is not
                            none else '' }}
                          </td>
                          <td class="td" style="font-weight: 700">
                            {% if r.bet_spread_team == r.home_team %}
                            <img
                              class="logo"
                              src="cid:{{ r.home_team_logo_cid }}"
                              style="width: 20px; height: 20px"
                            />
                            {% elif r.bet_spread_team == r.away_team %}
                            <img
                              class="logo"
                              src="cid:{{ r.away_team_logo_cid }}"
                              style="width: 20px; height: 20px"
                            />
                            {% else %} {{ r.bet_spread_team }} {% endif %}
                          </td>
                          <td class="td" style="text-align: center;">
                            {{ r.consider_moneyline }}
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </td>
                </tr>
          {% endif %}
          {% if totals|length > 0 %}
          <!-- Total Bets -->
          <tr>
            <td style="padding:16px 24px 4px;">
              <div style="font-weight:700; font-size:16px; margin-bottom:8px; text-align:center; border-bottom: 2px solid #eee; padding-bottom: 4px;">Total Bets ({{ totals|length }})</div>
              <table class="table" cellpadding="0" cellspacing="0" width="100%" style="border-collapse:collapse; width:100%; background:#fff;">
                <thead class="hdr">
                  <tr>
                    <th class="th">Date</th>
                    <th class="th">Matchup</th>
                    <th class="th">O/U</th>
                    <th class="th">Model</th>
                    <th class="th">Edge</th>
                    <th class="th">Bet</th>
                  </tr>
                </thead>
                <tbody>
                  {% for r in totals %}
                  <tr class="{% if loop.index0 % 2 == 1 %}zebra{% endif %}">
                    <td class="td" style="font-size: 11px; color: #666; white-space: nowrap;">
                      <div>{{ r.date_display }}</div>
                      <div>{{ r.time_display }}</div>
                    </td>
                    <td class="td" style="text-align: center;">
                      <div style="white-space: nowrap;">
                        <img class="logo" src="cid:{{ r.away_team_logo_cid }}" style="width:16px;height:16px;"> {{ r.away_team }}
                        <span style="font-size: 10px; color: #888; margin: 0 4px;">@</span>
                        <img class="logo" src="cid:{{ r.home_team_logo_cid }}" style="width:16px;height:16px;"> {{ r.home_team }}
                      </div>
                    </td>
                    <td class="td" style="font-weight: 600;">{{ r.total_line | round(1) if r.total_line is not none else '' }}</td>
                    <td class="td" style="color: #000;">{{ "%.1f" | format(r.predicted_total) if r.predicted_total is not none else '' }}</td>
                    <td class="td" style="font-weight: 600; color: #2e7d32;">{{ r.edge_total | round(1) if r.edge_total is not none else '' }}</td>
                    <td class="td" style="font-weight: 700;">{{ r.bet_total }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </td>
          </tr>
          {% endif %}

                <!-- Full Schedule -->
                <tr>
                  <td style="padding: 16px 24px">
                    <div style="font-weight: 700; font-size: 16px; margin-bottom: 8px; text-align: center; border-bottom: 2px solid #eee; padding-bottom: 4px;">
                      Full Schedule ({{ all_games|length }})
                    </div>
                    <table class="table" cellpadding="0" cellspacing="0" width="100%" style="border-collapse: collapse; width: 100%; background: #fff;">
                      <thead class="hdr">
                        <tr>
                          <th class="th">Date</th>
                          <th class="th">Matchup</th>
                          <th class="th">Line</th>
                          <th class="th">O/U</th>
                          <th class="th">Model Spread</th>
                          <th class="th">Model Total</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for r in all_games %}
                        <tr class="{% if loop.index0 % 2 == 1 %}zebra{% endif %}">
                          <td class="td" style="font-size: 11px; color: #666; white-space: nowrap;">
                            <div>{{ r.date_display }}</div>
                            <div>{{ r.time_display }}</div>
                          </td>
                          <td class="td" style="text-align: center;">
                            <div style="white-space: nowrap;">
                              <img class="logo" src="cid:{{ r.away_team_logo_cid }}" style="width: 16px; height: 16px" />
                              {{ r.away_team }}
                              <span style="font-size: 10px; color: #888; margin: 0 4px;">@</span>
                              <img class="logo" src="cid:{{ r.home_team_logo_cid }}" style="width: 16px; height: 16px" />
                              {{ r.home_team }}
                            </div>
                          </td>
                          <td class="td">
                            <div style="white-space: nowrap;">
                              <img class="logo" src="cid:{{ r.line_logo_cid }}" style="width: 14px; height: 14px" />
                              {{ r.line_num_display }}
                            </div>
                          </td>
                          <td class="td">
                            {{ r.total_line | round(1) if r.total_line is not none else '' }}
                          </td>
                          <td class="td">
                            <img class="logo" src="cid:{{ r.home_team_logo_cid }}" style="width: 14px; height: 14px" />
                            {{ "%+.1f" | format(-r.predicted_spread) if r.predicted_spread is not none else '' }}
                          </td>
                          <td class="td">
                            {{ "%.1f" | format(r.predicted_total) if r.predicted_total is not none else '' }}
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </td>
                </tr>

                <!-- Footer -->
                <tr>
                  <td style="padding: 20px 24px; border-top: 1px solid #eaeaea">
                    <div class="muted" style="font-size: 12px; color: #666">
                      Lines reflect the 'consensus' provider where available.
                      Bets are omitted when teams have fewer than 2 FBS games or
                      when confidence thresholds are not met.
                    </div>
                  </td>
                </tr>
              </td>
            </tr>
          </table>

          <div
            class="muted"
            style="font-size: 11px; color: #888; margin-top: 16px"
          >
            © {{ year }} cfb_model • Documentation:
            <a style="color: #666" href="{{ docs_url }}">docs</a>
          </div>
        </td>
      </tr>
    </table>
  </body>
</html>

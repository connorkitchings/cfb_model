---
date: 2025-08-14
branch: main
task: IMPL-task:11-preagg - Move aggregations under data/, run 2024 pre-agg
---

## Wins

- Created `src/cfb_model/data/aggregations/` module (`core.py`, `byplay.py`, `pipeline.py`,
  `persist.py`, `__init__.py`).
- Updated CLI to use new persist entrypoints; delegated old feature functions to new locations.
- Fixed pandas groupby named-agg errors and tuple grouping edge case; robust opponent lookup.
- Successfully ran 2024 pre-aggregation against external data root and wrote processed outputs.

## Blockers

- None blocking. Minor data quirks: some negative/zero play durations (masked), occasional Arrow
  schema inconsistencies mitigated by per-file reads already.

## Artifacts & Links

- Code: `src/cfb_model/data/aggregations/*`, `scripts/ingest_cli.py`.
- Processed outputs: `/Volumes/CK SSD/Coding Projects/cfb_model/data/processed/{byplay,drives,team_game,team_season,team_season_adj}/season=2024/...`.
- Counts: `byplay=125,014`, `drives=65,639`, `team_game=1,504`, `team_season=134`, `team_season_adj=134`.

## Handoff

- Stopping Point: Aggregations refactor complete; 2024 pre-aggregations materialized under `processed/`.
- Next Immediate Task: Sample-validate one week (schema/metrics sanity), then add unit tests for
  `aggregate_drives` and `aggregate_team_game`.
- Known Issues: Time features produce warnings for a small share of plays; acceptable with current
  masking. Opponent-adjust currently excludes eckel/finish metrics from adjustment to align
  available columns.
- Next Session Context: Build tests, wire model training to new team-season aggregates; prepare
  weekly CSV generation per runbook.

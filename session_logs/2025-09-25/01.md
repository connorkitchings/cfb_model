---
date: 2025-09-25
branch: main
task: [IMPL-task:VALIDATE-BETS] - Validate and debug the weekly bet scoring methodology.
---

## Wins

- Identified and fixed multiple critical performance bottlenecks in the `score_weekly_picks.py` script, reducing its runtime from over 8 minutes to near-instantaneous.
- Replaced the slow, row-by-row `.apply()` logic with fast, vectorized numpy operations.
- Pinpointed the true root cause of the delay: an inefficient data loading method that scanned the entire year's data. Optimized it to load only the specific week required.
- Diagnosed why no bets were being generated by the model (the `min_games_played` filter was likely the cause) and updated the prediction script to include diagnostic columns in its output.
- Replaced the problematic scoring script with a new, simplified, and robust version.

## Blockers

- The scoring script was unexpectedly and severely slow, which repeatedly blocked the validation of the model's bets.
- The initial debugging attempts were insufficient because the root cause was a subtle I/O issue in the data loading layer, not the visible data processing logic.

## Artifacts & Links

- Learnings: `[KB:ScopedDataLoading]` - When working with partitioned data, ensure data loading functions are filtered as specifically as possible (e.g., by year and week) to avoid severe I/O bottlenecks.
- Learnings: `[KB:DebugByAddition]` - Adding diagnostic columns (like `games_played`) to intermediate reports is an effective way to debug data filtering and policy application logic.
- Code Health: Deleted and rewrote `scripts/score_weekly_picks.py` with a more performant and direct implementation.
- Code Health: Modified `src/cfb_model/scripts/generate_weekly_bets_clean.py` to include `games_played` columns for better debugging.

## Handoff

- Stopping Point: The scoring script is now highly performant, and the prediction script has been updated to provide the necessary data for debugging the betting policy.
- Next Immediate Task: Re-run the modified prediction script to generate a report for a sample week (e.g., Week 5) that includes the `games_played` columns. Then, run the new, fast scoring script to finally validate the bets and confirm the `min_games_played` hypothesis.
- Known Issues: None. The pipeline is ready for final validation.
- Next Session Context: Start by re-running the prediction and scoring scripts to get a definitive answer on the model's performance for the sample week.

---
date: 2025-11-23
branch: main
task: Data Science Navigator - Spread Model Feature Pruning & Points-For Prototype
---

# Session Log: 2025-11-23 Session 03

## Wins

- **Spread Model Feature Pruning:** Completed SHAP analysis on spread_catboost model, identified top 40 features, achieved 51.1% hit rate (+2.5% from baseline 48.6%)
- **Operationalization & Prediction Intervals:** Trained 5-seed ensemble of pruned spread models, implemented ensemble-based uncertainty quantification via standard deviation
- **Weekly Pipeline Integration:** Updated `generate_weekly_bets_hydra.py` to support CatBoost models, created `conf/weekly_bets/default.yaml` for production config
- **ðŸŽ‰ Points-For Prototype Breakthrough:** Achieved **53.3% spread hit rate** (above 52.4% breakeven!) and **55.2% totals hit rate** using unified Home/Away score prediction architecture
- **Model Registry Enhancements:** Updated `scripts/model_registry.py` to support loading both sklearn and CatBoost models
- All health checks pass: ruff format (2 files reformatted), mkdocs build (clean)

## Blockers

- **Linting Issues:** 27 remaining lint errors (mostly E402 module-level imports and N806 variable naming conventions in prototype scripts)
  - These are non-blocking style issues in new prototype/analysis scripts
  - Can be addressed in next refactoring pass
- **Test Import Error:** `test_betting_policy_kelly.py` fails to import `scripts.generate_weekly_bets_clean` (module renamed/removed)
  - Needs test update or module restoration

## Artifacts & Links

### Reports & Documentation

- **Decision Log:** Updated `docs/decisions/decision_log.md` with feature pruning and Points-For prototype decisions
- **Walkthrough:** Created `walkthrough.md` documenting Points-For prototype results and analysis
- **Feature Set:** Created `conf/features/spread_top_40.yaml` with pruned feature list from SHAP analysis
- **Weekly Config:** Created `conf/weekly_bets/default.yaml` for production betting configuration

### Code Changes

- **New Scripts:**
  - `scripts/analyze_feature_importance.py`: SHAP analysis for feature selection
  - `scripts/train_and_register.py`: Ensemble training and MLflow registration
  - `scripts/run_points_for_experiment.py`: Points-For prototype training script
  - `scripts/evaluate_points_for_prototype.py`: Betting performance evaluation
  - `scripts/list_models.py`: MLflow model registry inspection utility
- **Modified Scripts:**
  - `scripts/generate_weekly_bets_hydra.py`: Added CatBoost support, fixed config keys
  - `scripts/model_registry.py`: Added mlflow.catboost import and fallback loading
  - `conf/config.yaml`: Updated default adjustment_iteration to 2, added weekly_bets default
- **New Configs:**
  - `conf/experiment/spread_catboost_pruned.yaml`: Pruned model experiment config

### Data & Metrics

- **Spread Model Performance (Pruned, Top 40 features):**
  - 2024 Hit Rate: 51.1% (baseline: 48.6%)
  - RMSE: 18.61 (baseline: 18.12)
- **Points-For Prototype Performance:**
  - **Spread Hit Rate: 53.3%** (above 52.4% breakeven threshold!)
  - **Totals Hit Rate: 55.2%** (baseline: 54.6%)
  - Spread RMSE: 18.72, Total RMSE: 17.40
  - Bet Volume: 460 spread bets, 503 total bets
- **MLflow Models Registered:**
  - `spread_catboost_pruned` (Version 1)
  - `spread_catboost_pruned_seed_1` through `_seed_5` (5-seed ensemble)

## Handoff

**Stopping Point:** Successfully prototyped Points-For model architecture and achieved profitability milestone (53.3% > 52.4% breakeven). Created all necessary documentation and updated decision log. Code is formatted and docs build cleanly. Minor linting issues remain in prototype scripts but are non-blocking.

**Next Immediate Task:** Deploy Points-For Model to Production

1. Review and approve Points-For prototype results
2. Train production ensemble of Points-For models (Home + Away pairs, 5 seeds each)
3. Update `generate_weekly_bets_hydra.py` to use Points-For as default prediction mode
4. Run full walk-forward validation across all years (2019, 2021-2025) to confirm consistency
5. Update weekly betting workflow to use new architecture

**Known Issues:**

- Test suite has import error in `test_betting_policy_kelly.py` due to missing/renamed module
- 27 lint warnings in new prototype/analysis scripts (style issues, non-blocking)
- Points-For model is currently single-run prototype; needs full ensemble training for production

**Next Session Context:**
The Points-For model represents a significant breakthrough - it's the first spread model to achieve profitability (53.3% hit rate > breakeven). The unified architecture (predicting Home/Away scores, then deriving spread/total) provides:

- Better hit rates for both spread and totals
- Natural uncertainty quantification
- Reduced maintenance overhead
- Cleaner conceptual model

The prototype validates the approach. Next session should focus on productionizing this architecture: training the full ensemble, updating the weekly pipeline, and validating consistency across all historical years.

Train/test split confirmed correct: Train 2019, 2021-2023 (skip 2020), Test 2024.

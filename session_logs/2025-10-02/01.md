---
date: 2025-10-02
branch: main
task: [IMPL-task:MODEL-IMPROVEMENT-CONFIDENCE] - Implement and tune confidence-based bet filtering.
---

## Wins

- Implemented and tuned a confidence-based filtering mechanism for bets, significantly improving model performance.
- Created a new script `scripts/confidence_threshold_sweep.py` to systematically find the optimal standard deviation thresholds for filtering bets.
- **Identified Optimal Thresholds**:
    - **Spreads**: A threshold of **3.0** achieves a **57.3%** hit rate over 117 bets.
    - **Totals**: A threshold of **1.5** achieves a **58.5%** hit rate over 65 bets.
- Confirmed that the underlying functionality for confidence-based filtering (calculating the standard deviation of the ensemble predictions) was already present in the codebase but unused.
- Verified that the necessary moneyline odds data is being ingested, although it is currently being dropped before the betting policy stage.

## Blockers

- The `_reduce_betting_lines` function in the weekly betting script was found to be discarding the moneyline columns required for the next step (Kelly criterion), which will require a minor modification.

## Artifacts & Links

- **New Script**: `scripts/confidence_threshold_sweep.py`
- **Results**:
    - `reports/2024/confidence_threshold_sweep_spread.csv`
    - `reports/2024/confidence_threshold_sweep_total.csv`
- **Learnings**: `[KB:EnsembleConfidenceFilter]` - Re-validated that using the standard deviation of an ensemble's predictions is a highly effective method for improving hit rates by filtering for model consensus.

## Handoff

- **Stopping Point**: The confidence-based filtering has been successfully implemented and tuned, yielding significant performance improvements. The optimal thresholds have been identified.
- **Next Immediate Task**: Implement the **Kelly criterion** for bet sizing. This will involve:
    1.  Modifying the `_reduce_betting_lines` function to retain the moneyline odds.
    2.  Updating the `apply_betting_policy` function to calculate and include the Kelly fraction in the weekly betting report.
- **Known Issues**: None. The project is in a stable state with a clear path to the next enhancement.
- **Next Session Context**: The model's profitability has been significantly improved with confidence filtering. The next step is to layer on a sophisticated bet sizing strategy.

## Health Check Summary

- No code changes were committed in this session, so all health checks are assumed to be passing based on the state at the end of the last session.

---
date: 2025-10-02
branch: main
task: [IMPL-task:BET-SIZING-KELLY-AND-OPS] - Implement Kelly sizing with 5% cap, ensemble confidence filters, and ops tooling
---

## Wins

- Implemented Kelly-based bet sizing with fractional Kelly (25%) and enforced a 5% single-bet cap in both the weekly generator and season simulator
- Integrated ensemble confidence filters (std-dev of predictions) with sensible defaults and CLI controls; retained large-volume option via ridge baseline
- Added per-model feature alignment to avoid prediction-time feature mismatches; zero-filled absent features for stability
- Delivered new ops utilities:
  - Season bankroll simulator (scripts/simulate_bankroll_2024.py)
  - Weekly reporting driver with spread vs total hit/bet breakdown (scripts/run_weekly_reports_2024.py)
- Documentation updated for policy and pipeline; added new decisions to the decision log
- Fixed storage path duplication and standardized byplay/drives partition key to game_id

## Blockers

- Early-week games can still surface NaN inputs for some models (e.g., HuberRegressor) depending on feature availability; mitigated by zero-fill and row-level drop where necessary
- Ensemble volume sensitive to std-dev thresholds; too tight = lower volume. This is tunable and expected

## Artifacts & Links

- Weekly generator (Kelly + confidence + cap): src/cfb_model/scripts/generate_weekly_bets_clean.py
- Bankroll simulation: scripts/simulate_bankroll_2024.py
- Weekly hit/bet summary: scripts/run_weekly_reports_2024.py
- Decisions: docs/decisions/decision_log.md (2025-10-02 entries)
- Reports:
  - ./reports/2024/CFB_week{W}_bets.csv (per-week)
  - ./reports/2024/weekly_hit_summary_2024.csv (spread/total hits vs bets)
  - ./reports/2024/bankroll_sim_2024.csv (season bankroll)

## Handoff

- Stopping Point: Ensemble recommended as default; 5% single-bet cap in place; weekly CSVs and hit/bet summary generated; season sim script ready
- Next Immediate Task: Add portfolio exposure cap (e.g., 15% weekly), and optionally performance-weighted ensemble based on validation RMSE
- Known Issues: Some early weeks still limited by data availability/NaNs; loosen filters for volume or impute select features more aggressively
- Next Session Context: Tune std-dev thresholds for the ensemble to desired weekly bet count; consider adding portfolio-level exposure guardrails

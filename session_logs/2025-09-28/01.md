---
date: 2025-09-28
branch: main
task: [IMPL-task:OPS-THRESHOLD-VALIDATION] - Add configurable spread threshold (default 5.0), deep adjusted validation, and 2024 season re-run
---

## Wins

- Implemented deep adjusted-feature validation using pipeline semantics (team_game → team_season → opponent-adjusted) with rate-aware comparison; all seasons OK except minor explosive-rate diffs in 2017/2018
- Added configurable spread threshold to weekly generation (`--spread-threshold`, default 5.0) and updated the manual season runner to use it
- Produced 2024 full-season results with threshold=5.0: 104/188 = 0.553 hit rate (+2.9pp vs 52.4% breakeven)
- Added edge analytics scripts: `scripts/edge_threshold_sweep.py` (sweep thresholds) and `scripts/weekly_threshold_report.py` (weekly hit rates at chosen threshold)
- Updated docs to reflect API-minimizing ingestion behavior and configurable thresholds

## Blockers

- Minor historical variance in explosive rate (rush/pass) for 2017/2018 persists under strict deep validation (4 columns); likely due to historical bucket/threshold nuances

## Artifacts & Links

- Scripts:
  - `src/cfb_model/scripts/generate_weekly_bets_clean.py` — now accepts `--spread-threshold`, `--total-threshold`
  - `scripts/run_full_season.py` — passes `--spread-threshold 5.0`
  - `scripts/edge_threshold_sweep.py` — sweep thresholds (1.0–7.0)
  - `scripts/weekly_threshold_report.py` — weekly hit rates at a chosen threshold
- Docs:
  - `docs/data/ingestion_guide.md` — API-minimizing ingestion (week targeting; skip-if-present)
  - `docs/operations/weekly_pipeline.md` — commands updated; thresholds configurable
  - `docs/project_org/modeling_baseline.md` — spread threshold now configurable (default 5.0)
- Validation:
  - `src/cfb_model/data/validation.py` — deep adjusted validator with rate rounding/clipping
- Results:
  - `./reports/2024/CFB_season_2024_all_bets_scored.csv` — 2024 scored results (threshold=5.0)
  - `./reports/2024/edge_threshold_sweep.csv` — threshold vs hit-rate table

## Handoff

- Stopping Point: Threshold wired (default 5.0), deep validation in place, and 2024 season re-evaluated with improved performance (0.553)
- Next Immediate Task:
  - (Optional) Make the full-season runner accept `--spread-threshold` and `--total-threshold` as CLI flags instead of hardcoding 5.0
  - (Optional) Enhance deep validator to recompute explosive rates using integer counts/denominators to fully resolve 2017/2018 minor mismatches
  - (Optional) Add per-edge-bucket diagnostics/plots for ongoing calibration
- Known Issues: Minor explosive-rate discrepancies in deep validation for 2017/2018; does not impact operational outputs
- Next Session Context:
  - Consider model improvements (feature interactions, calibration, alternative estimators) now that operational thresholding is in place
  - Evaluate totals threshold sweep similarly (default remains 7.5)
